global
    daemon
    log stdout local0

defaults
    mode tcp
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    log global

# MQTT Load Balancing
frontend mqtt_frontend
    bind *:1883
    default_backend mqtt_brokers

backend mqtt_brokers
    balance source
    option tcp-check
    tcp-check connect port 1883
    server broker1 mqtt-broker-1:1883 check inter 5s fall 3 rise 2
    server broker2 mqtt-broker-2:1883 check inter 5s fall 3 rise 2
    server broker3 mqtt-broker-3:1883 check inter 5s fall 3 rise 2

# HAProxy Statistics
frontend stats
    bind *:8080
    mode http
    stats enable
    stats uri /stats
    stats refresh 30s
    stats admin if TRUE
    stats realm "HAProxy\ Statistics"
    stats hide-version
